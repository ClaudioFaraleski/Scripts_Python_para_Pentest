import requests

def verificar_url(url, api_key):
    try:
        # Consulta inicial para obter o scan_id
        params = {'apikey': api_key, 'url': url}
        response = requests.post('https://www.virustotal.com/vtapi/v2/url/scan', data=params)
        json_response = response.json()

        if json_response['response_code'] == 1:
            # Scan_id obtido, agora você pode buscar os resultados
            scan_id = json_response['scan_id']
            result = buscar_resultados(scan_id, api_key)
            if result['positives'] == 0:
                print(f"A URL {url} está acessível e não foi detectado malware ou virus .")
            else:
                print(f"A URL {url} foi detectada com {result['positives']} antivírus.")
        else:
            print(f"A verificação da URL {url} falhou. Mensagem: {json_response['verbose_msg']}")

    except requests.ConnectionError:
        print(f"A URL {url} não pôde ser alcançada. Verifique a conexão com a internet.")

def buscar_resultados(scan_id, api_key):
    params = {'apikey': api_key, 'resource': scan_id}
    response = requests.get('https://www.virustotal.com/vtapi/v2/url/report', params=params)
    return response.json()

# Substitua 'SUA_CHAVE_API' pela chave de API fornecida pelo VirusTotal
chave_api_virustotal = 'Colocar Chave de API'
url_a_verificar = input("Cole a Url aqui:  ")
verificar_url(url_a_verificar, chave_api_virustotal)
