import requests
import socket

def verificar_url(url, api_key):
    try:
        # Consulta inicial para obter o scan_id
        params = {'apikey': api_key, 'url': url}
        response = requests.post('https://www.virustotal.com/vtapi/v2/url/scan', data=params)
        json_response = response.json()

        if json_response['response_code'] == 1:
            # Scan_id obtido, agora você pode buscar os resultados
            scan_id = json_response['scan_id']
            result = buscar_resultados(scan_id, api_key)
            if result['positives'] == 0:
                print(f"A URL {url} está acessível e não foi detectado Virus.")
            else:
                print(f"A URL {url} foi detectada com {result['positives']} antivírus.")

                # Exibir detalhes das detecções dos antivírus
                exibir_deteccoes_antivirus(result['scans'])

                # Exibir informações adicionais de análise de fornecedores de segurança
                print("\nInformações de Análise de Fornecedores de Segurança:")
                for antivirus, resultado in result['scans'].items():
                    if 'verbose_msg' in resultado and resultado['verbose_msg']:
                        print(f"{antivirus}: {resultado['verbose_msg']}")

            # Obter informações adicionais da URL
            informacoes_url = obter_informacoes_url(url)
            print("\nInformações da URL:")
            for chave, valor in informacoes_url.items():
                print(f"{chave}: {valor}")

        else:
            print(f"A verificação da URL {url} falhou. Mensagem: {json_response['verbose_msg']}")

    except requests.ConnectionError:
        print(f"A URL {url} não pôde ser alcançada. Verifique a conexão com a internet.")

def buscar_resultados(scan_id, api_key):
    params = {'apikey': api_key, 'resource': scan_id}
    response = requests.get('https://www.virustotal.com/vtapi/v2/url/report', params=params)
    return response.json()

def obter_informacoes_url(url):
    try:
        # Faz uma solicitação HTTP para obter informações sobre a URL
        response = requests.head(url, allow_redirects=True)

        # Obter o endereço IP associado à URL
        endereco_ip = socket.gethostbyname(response.url.split('/')[2])

        informacoes = {
            'URL': url,
            'Endereço IP do Servidor': endereco_ip,
            'Código de Status HTTP': response.status_code,
            
        }

        return informacoes

    except requests.ConnectionError:
        print("Não foi possível obter informações da URL. Verifique a conexão com a internet.")
        return {}

def exibir_deteccoes_antivirus(scans):
    print("\nDetecções de Antivírus:")
    for antivirus, resultado in scans.items():
        print(f"{antivirus}: {resultado['result']}")

# Substitua 'SUA_CHAVE_API' pela chave de API fornecida pelo VirusTotal
chave_api_virustotal = 'Colocar Chave de API'
url_a_verificar = input("Cole Aqui sua URL :")
verificar_url(url_a_verificar, chave_api_virustotal)
